pivot_wider(
names_from = region, # Pivot on the "region" column
values_from = value # Use "value" column for the data
) %>%
mutate(urban_rural_diff = urban - rural,
party = case_match(party, "cducsu" ~ "CDU/CSU", "spd" ~ "SPD",
"fdp" ~ "FDP", "rwparties" ~ "Right-wing nationalist"),
party = factor(party, levels = c("CDU/CSU", "SPD", "FDP", "Right-wing nationalist")))
# Estimate
model_urban_rural <-
feols(c(cdu_csu_share, spd_share, fdp_share, rw_parties_share) ~ pop_density,
fixef = "key_state",
split = ~year,
data = gpwed %>% filter(vote_type == "second") %>%
group_by(year) %>%
mutate(voters_eligible = scale(voters_eligible),
pop_density = scale(pop_density)
) %>%
ungroup())
model_urban_rural_tidy <- model_urban_rural %>%
imap(~ broom::tidy(.x, conf.int = T) %>% mutate(spec = .y)) %>%
bind_rows() %>%
mutate(year = as.numeric(str_extract(spec, "(?<=sample: ).*(?=;)")),
lhs = str_extract(spec, "(?<=lhs: ).*"),
lhs = case_match(lhs, "cdu_csu_share" ~ "CDU/CSU",
"spd_share" ~ "SPD", "fdp_share" ~ "FDP",
"rw_parties_share" ~ "Right-wing nationalist",
.default = lhs),
lhs = factor(lhs, c("CDU/CSU", "SPD", "FDP", "Right-wing nationalist")))
View(model_urban_rural_tidy)
# Load libraries
library(tidyverse)
library(knitr)
library(fixest)
source("~/Dropbox/my_functions.R")
clear_environment()
# Analyze measurement error using historical data ------------------------------
## Process 1953 ----
# Read imputed data
btw_53_imputed <- read_rds("./output/cleaned/53_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
relocate(cdu, spd, fdp, .after = imputed) %>%
mutate(other = rowSums(select(., dp:center), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(dp:center)) %>%
drop_na(votes_valid)
# Aggregate counts to county level
vote_counts_scraped <- btw_53_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(county_name, regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
# Read official county returns
btw_53_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1953_counties.rds") %>%
mutate(other = rowSums(select(., gb_bhe:ssw), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(csu, gb_bhe:ssw))
# Match county keys to official data
counties53_keys <- read_rds("./additional_data/administrative_info/counties1953_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_53_counties_admin, counties53_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
# Combine curated and official data to compare
vote_counts_compare53 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
group_by(regional_key) %>% filter(n() == 1) %>% ungroup() %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1953)
## Process 1957 ----
btw_57_imputed <- read_rds("./output/cleaned/57_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
relocate(fdp, .after = spd) %>%
mutate(other = rowSums(select(., dp:ssw), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(dp:ssw)) %>%
drop_na(votes_valid)
btw_57_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1957_counties.rds") %>%
mutate(other = rowSums(select(., dp:other), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(csu, dp:gb_bhe))
counties57_keys <- read_rds("./additional_data/administrative_info/counties1957_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_57_counties_admin, counties57_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_57_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(county_name, regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare57 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
group_by(regional_key) %>% filter(n() == 1) %>% ungroup() %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1957)
## Process 1961 ----
btw_61_imputed <- read_rds("./output/cleaned/61_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
mutate(other = rowSums(select(., gdp:other), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(gdp:ssw)) %>%
drop_na(votes_valid)
btw_61_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1961_counties.rds") %>%
mutate(other = rowSums(select(., gdp:ssw), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(csu, gdp:ssw))
counties61_keys <- read_rds("./additional_data/administrative_info/counties1961_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_61_counties_admin, counties61_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_61_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(county_name, regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare61 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
group_by(regional_key) %>% filter(n() == 1) %>% ungroup() %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1961)
## Process 1965 ----
btw_65_imputed <- read_rds("./output/cleaned/65_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
mutate(other = rowSums(select(., dfu:uap), na.rm = T),
key_state = str_sub(ags, 1, 2)) %>%
filter(key_state != "07") %>%
relocate(other, .after = fdp) %>%
select(-c(dfu:uap)) %>%
drop_na(votes_valid)
btw_65_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1965_counties.rds")
counties65_keys <- read_rds("./additional_data/administrative_info/counties1965_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_65_counties_admin, counties65_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_65_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare65 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1965)
## Process 1969 ----
btw_69_imputed <- read_rds("./output/cleaned/69_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
mutate(other = rowSums(select(., adf:uap), na.rm = T), key_state = str_sub(ags, 1, 2)) %>%
relocate(other, .after = fdp) %>%
select(-c(adf:uap)) %>%
drop_na(votes_valid)
btw_69_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1969_counties.rds")
counties69_keys <- read_rds("./additional_data/administrative_info/counties1969_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_69_counties_admin, counties69_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
mutate(other = rowSums(select(., npd, adf, other))) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_69_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare69 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1969)
View(btw_53_imputed)
# Load libraries
library(tidyverse)
library(knitr)
library(fixest)
source("~/Dropbox/my_functions.R")
clear_environment()
# Analyze measurement error using historical data ------------------------------
## Process 1953 ----
# Read imputed data
btw_53_imputed <- read_rds("./output/cleaned/53_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
relocate(cdu, spd, fdp, .after = imputed) %>%
mutate(other = rowSums(select(., dp:center), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(dp:center)) %>%
drop_na(votes_valid)
# Aggregate counts to county level
vote_counts_scraped <- btw_53_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(county_name, regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
# Read official county returns
btw_53_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1953_counties.rds") %>%
mutate(other = rowSums(select(., gb_bhe:ssw), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(csu, gb_bhe:ssw))
# Match county keys to official data
counties53_keys <- read_rds("./additional_data/administrative_info/counties1953_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_53_counties_admin, counties53_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
# Combine curated and official data to compare
vote_counts_compare53 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
group_by(regional_key) %>% filter(n() == 1) %>% ungroup() %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1953)
## Process 1957 ----
btw_57_imputed <- read_rds("./output/cleaned/57_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
relocate(fdp, .after = spd) %>%
mutate(other = rowSums(select(., dp:ssw), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(dp:ssw)) %>%
drop_na(votes_valid)
btw_57_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1957_counties.rds") %>%
mutate(other = rowSums(select(., dp:other), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(csu, dp:gb_bhe))
counties57_keys <- read_rds("./additional_data/administrative_info/counties1957_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_57_counties_admin, counties57_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_57_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(county_name, regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare57 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
group_by(regional_key) %>% filter(n() == 1) %>% ungroup() %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1957)
## Process 1961 ----
btw_61_imputed <- read_rds("./output/cleaned/61_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
mutate(other = rowSums(select(., gdp:other), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(gdp:ssw)) %>%
drop_na(votes_valid)
btw_61_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1961_counties.rds") %>%
mutate(other = rowSums(select(., gdp:ssw), na.rm = T)) %>%
relocate(other, .after = fdp) %>%
select(-c(csu, gdp:ssw))
counties61_keys <- read_rds("./additional_data/administrative_info/counties1961_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_61_counties_admin, counties61_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_61_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(county_name, regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare61 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
group_by(regional_key) %>% filter(n() == 1) %>% ungroup() %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1961)
## Process 1965 ----
btw_65_imputed <- read_rds("./output/cleaned/65_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
mutate(other = rowSums(select(., dfu:uap), na.rm = T),
key_state = str_sub(ags, 1, 2)) %>%
filter(key_state != "07") %>%
relocate(other, .after = fdp) %>%
select(-c(dfu:uap)) %>%
drop_na(votes_valid)
btw_65_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1965_counties.rds")
counties65_keys <- read_rds("./additional_data/administrative_info/counties1965_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_65_counties_admin, counties65_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_65_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare65 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1965)
## Process 1969 ----
btw_69_imputed <- read_rds("./output/cleaned/69_btw_imputed.rds") %>%
filter(first_second_vote == "second") %>%
mutate(other = rowSums(select(., adf:uap), na.rm = T), key_state = str_sub(ags, 1, 2)) %>%
relocate(other, .after = fdp) %>%
select(-c(adf:uap)) %>%
drop_na(votes_valid)
btw_69_counties_admin <- read_rds("./additional_data/county_data_bundeswahlleiter/btw_1969_counties.rds")
counties69_keys <- read_rds("./additional_data/administrative_info/counties1969_admin.rds") %>%
select(key_state, regional_key, county_name)
vote_counts_admin <-
left_join(btw_69_counties_admin, counties69_keys, by = c("county_name", "key_state")) %>%
relocate(matches("key"), .before = everything()) %>%
mutate(other = rowSums(select(., npd, adf, other))) %>%
select(county_name, regional_key, voters_eligible, votes_valid, cdu, spd, fdp, other) %>%
drop_na(regional_key)
vote_counts_scraped <- btw_69_imputed %>%
mutate(regional_key = str_sub(ags, 1, 5)) %>%
group_by(regional_key) %>%
summarise(across(c(votes_valid, cdu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop")
vote_counts_compare69 <-
left_join(vote_counts_scraped, vote_counts_admin, by = "regional_key", suffix = c("_scraped", "_admin")) %>%
relocate(matches("county_name|key"), .before = everything()) %>%
mutate(across(cdu_scraped:other_scraped, ~ .x/votes_valid_scraped)) %>%
mutate(across(cdu_admin:other_admin, ~ .x/votes_valid_admin)) %>%
pivot_longer(names_to = c("measure", "scraped"), names_sep = "_(?=scraped)|_(?=admin)",
cols = matches("spd|cdu|fdp|other")) %>%
pivot_wider(names_from = scraped, values_from = value) %>%
mutate(error = scraped-admin) %>%
mutate(year = 1969)
## Combine and tabulate/plot ----
vote_counts_compare <-
bind_rows(vote_counts_compare53, vote_counts_compare57,
vote_counts_compare61, vote_counts_compare65,
vote_counts_compare69) %>%
mutate(error = error*100) %>%
arrange(county_name_scraped, year) %>%
mutate(state = str_sub(regional_key, 1, 2),
state = ifelse(state == "48", "10", state))
View(vote_counts_compare)
quantile(vote_counts_compare$error)
quantile(vote_counts_compare$error, na.rm = T)
quantile(vote_counts_compare$error, na.rm = T, probs = seq(0,1,.1))
quantile(vote_counts_compare$error, na.rm = T, probs = seq(0,1,.01))
quantile(abs(vote_counts_compare$error), na.rm = T, probs = seq(0,1,.01))
quantile(abs(vote_counts_compare$error), na.rm = T, probs = seq(0,1,.1))
quantile(abs(vote_counts_compare$error), na.rm = T, probs = seq(0,1,.05))
quantile(abs(vote_counts_compare$error), na.rm = T, probs = seq(0,1,.1))
mean(vote_counts_compare$error == 0)
mean(vote_counts_compare$error == 0, na.rm = T)
mean(vote_counts_compare$error < .01, na.rm = T)
mean(abs(vote_counts_compare$error < .01), na.rm = T)
mean(abs(vote_counts_compare$error)  < .01, na.rm = T)
mean(abs(vote_counts_compare$error)  < 1, na.rm = T)
mean(abs(vote_counts_compare$error)  < .05, na.rm = T)
mean(abs(vote_counts_compare$error)  < .1, na.rm = T)
mean(abs(vote_counts_compare$error)  < 1, na.rm = T)
mean(abs(vote_counts_compare$error)  < .5, na.rm = T)
# Read GPWED data
gpwed <- read_rds("./output/final_database/gpwed.rds")
# Aggregate to county level
gpwed_county <-
gpwed %>%
# Merge cdu_csu with cvp to be consistent with erfort
mutate(cdu_csu = ifelse(key_state == "10" & year == 1957, rowSums(select(., cdu_csu, cvp)), cdu_csu),
cvp = ifelse(key_state == "10" & year == 1957, NA, cvp)) %>%
mutate(ags_county = str_sub(ags, 1, 5)) %>%
relocate(cdu_csu, spd, fdp, .after = votes_valid) %>%
mutate(other = rowSums(select(., dp:center_fu), na.rm = T)) %>%
group_by(ags_county, year) %>%
summarise(across(c(votes_valid, cdu_csu, spd, fdp, other), ~ sum(.x, na.rm = T)), .groups = "drop") %>%
mutate(across(cdu_csu:other, ~ ifelse(votes_valid == 0, NA, .x)),
votes_valid = ifelse(votes_valid == 0, NA, votes_valid),
across(cdu_csu:other, ~ .x/votes_valid))
# Read Erfort data
load("./additional_data/county_data_erfort/germany-53-21-districts/election-results-53-21.RData")
results_erfort <-
results_long %>%
filter(year %in% 1953:1969) %>%
pivot_wider(names_from = party, values_from = vote_share) %>%
rename_with(~ tolower(str_replace_all(.x, "-", "_"))) %>%
select(ags, year, valid_votes, cdu_csu, spd, fdp) %>%
mutate(other = 1 - rowSums(select(., cdu_csu:fdp)))
rm(list = c("results_long"))
# Merge GPWED and Erfort estimates
gpwed_erfort_comparison <-
left_join(gpwed_county, results_erfort, by = c("ags_county" = "ags", "year"), suffix = c(".own", ".erfort")) %>%
relocate(votes_valid, valid_votes, .after = year) %>%
pivot_longer(cdu_csu.own:other.erfort, names_sep = "\\.", names_to = c("party", "source")) %>%
pivot_wider(values_from = value, names_from = source) %>%
mutate(error = (own - erfort)*100)
View(gpwed_erfort_comparison)
View(gpwed_erfort_comparison)
gpwed_erfort_comparison %>%
group_by(party) %>%
summarise(own = mean(own, na.rm = T))
.63/46.9
View(gpwed_erfort_comparison)
gpwed_erfort_comparison %>%
group_by(party) %>%
summarise(own = sd(own, na.rm = T))
.63/15.2
# Load libraries
library(tidyverse)
library(sf)
library(rmapshaper)
library(patchwork)
rm(list = ls())
gpwed <- read_rds("./output/final_database/gpwed.rds")
# Data overview -----------------------------------------------------------------
na_info <-
gpwed %>%
mutate(non_missing = !is.na(votes_valid)) %>%
group_by(key_state, year, vote_type) %>%
summarise(non_missing = mean(non_missing), .groups = "drop") %>%
mutate(
state_lab = case_match(key_state, "01" ~ "Schleswig-Holstein", "02" ~ "Hamburg", "03" ~ "Niedersachsen",
"04" ~ "Bremen", "05" ~ "Nordrhein-Westfalen", "06" ~ "Hessen", "07" ~ "Rheinland-Pfalz",
"08" ~ "Baden-Württemberg", "09" ~ "Bayern", "10" ~ "Saarland"),
state_lab = factor(state_lab, levels = rev(c("Schleswig-Holstein", "Hamburg", "Niedersachsen",
"Bremen", "Nordrhein-Westfalen", "Hessen", "Rheinland-Pfalz",
"Baden-Württemberg", "Bayern", "Saarland"))),
non_missing = round(non_missing, 2),
non_missing = non_missing*100,
non_missing_lab = paste0(non_missing, "%"))
overview_data_second_votes <-
na_info %>%
filter(vote_type == "second") %>%
ggplot(., aes(x = year, y = state_lab, fill = non_missing)) +
geom_tile(color = "white") +
geom_text(aes(label = non_missing_lab), size = 3) +
scale_x_continuous(breaks  = seq(1949, 1969, 4)) +
labs(x = "Election", y = "State") +
theme_bw() +
theme(legend.position = "none",
axis.text.y = element_text(size = 12),
text = element_text(size = 15))
overview_data_first_votes <-
na_info %>%
filter(vote_type == "first") %>%
ggplot(., aes(x = year, y = state_lab, fill = non_missing)) +
geom_tile(color = "white") +
geom_text(aes(label = non_missing_lab), size = 3) +
scale_x_continuous(breaks  = seq(1949, 1969, 4)) +
labs(x = "Election", y = "State") +
theme_bw() +
theme(legend.position = "none",
axis.text.y = element_text(size = 12),
text = element_text(size = 15))
overview_data_second_votes
gpwed <- read_rds("./output/final_database/gpwed.rds")
# This script contains the code for all figures and analyses in the data
# descriptor
#
# Load libraries
library(tidyverse)
library(sf)
library(rmapshaper)
library(patchwork)
source("~/Dropbox/my_functions.R")
rm(list = ls())
gpwed <- read_rds("./output/final_database/gpwed.rds")
View(gpwed)
